<?php
/** -------------------------------------------------------------------------------------------------------------------- ** 
/** -------------------------------------------------------------------------------------------------------------------- ** 
/** ---																																					--- **
/** --- 											-----------------------------------------------											--- **
/** ---															{ update_table.php }																--- **
/** --- 											-----------------------------------------------											--- **
/** ---																																					--- **
/** ---		TAB SIZE			: 3																													--- **
/** ---																																					--- **
/** ---		AUTEUR			: Nicolas DUPRE																									--- **
/** ---																																					--- **
/** ---		RELEASE			: 20.04.2017																										--- **
/** ---																																					--- **
/** ---		FILE_VERSION	: 1.1 NDU																											--- **
/** ---																																					--- **
/** ---																																					--- **
/** --- 														---------------------------														--- **
/** ---																{ G I T H U B }																--- **
/** --- 														---------------------------														--- **
/** ---																																					--- **
/** ---		Automatize url?ts=3 :																												--- **
/** ---																																					--- **
/** ---			https://chrome.google.com/webstore/detail/tab-size-on-github/ofjbgncegkdemndciafljngjbdpfmbkn/related	--- **
/** ---																																					--- **
/** ---																																					--- **
/** --- 														-----------------------------														--- **
/** --- 															{ C H A N G E L O G } 															--- **
/** --- 														-----------------------------														--- **
/** ---																																					--- **
/** ---																																					--- **
/** ---		VERSION 1.1 : 20.04.2017 : NDU																									--- **
/** ---		------------------------------																									--- **
/** ---			- Transformation en update_table, plus générale																			--- **
/** ---			- Ajout d'une nouvelle donnée : type																						--- **
/** ---				> Type permet de faire des opérations de conversion sur la valeur spécifiée								--- **
/** ---				> Type permet de specifier le format de donnée pour PDO::bindValue											--- **
/** ---			- Ajout du contrôle d'authentification																						--- **
/** ---																																					--- **
/** ---																																					--- **
/** ---		VERSION 1.0 : 17.04.2017 : NDU																									--- **
/** ---		------------------------------																									--- **
/** ---			- Première release																												--- **
/** ---																																					--- **
/** -------------------------------------------------------------------------------------------------------------------- **
/** -------------------------------------------------------------------------------------------------------------------- **

	Objectif du script :
	---------------------
	
	Description fonctionnelle :
	----------------------------
	
/** -------------------------------------------------------------------------------------------------------------------- **
/** -------------------------------------------------------------------------------------------------------------------- **
/** ---																																					--- **
/** ---													PHASE 1 - INITIALISATION DU SCRIPT													--- **
/** ---																																					--- **
/** -------------------------------------------------------------------------------------------------------------------- **
/** -------------------------------------------------------------------------------------------------------------------- **
/** > Chargement des Paramètres **/
	setup('/Setups', Array('application', 'pdo', 'sessions'), 'setup.$1.php');

/** > Ouverture des SESSIONS Globales **/
/** > Chargement des Classes **/
/** > Chargement des Configs **/
/** > Chargement des Fonctions **/

/** -------------------------------------------------------------------------------------------------------------------- **
/** -------------------------------------------------------------------------------------------------------------------- **
/** ---																																					--- **
/** ---												PHASE 2 - CONTROLE DES AUTORISATIONS													--- **
/** ---																																					--- **
/** -------------------------------------------------------------------------------------------------------------------- **/
if(!isset($_SESSION["MGDG-ADMIN"]) && !$_SESSION["MGDG-ADMIN"]) exit;



/** -------------------------------------------------------------------------------------------------------------------- **
/** -------------------------------------------------------------------------------------------------------------------- **
/** ---																																					--- **
/** ---												PHASE 3 - INITIALISAITON DES DONNEES													--- **
/** ---																																					--- **
/** -------------------------------------------------------------------------------------------------------------------- **
/** -------------------------------------------------------------------------------------------------------------------- **/
/** > Déclaration des variables **/
	$table;			// STRING			:: Valeur du chammps à mettre à jour
	$property;		// STRING			:: Champs SQL à mettre à jour
	$value;			// STRING			:: Valeur du chammps à mettre à jour
	$id;				// STRING			:: Identifiant de l'objet à mettre à jour
	$query;			// STRING			:: Requête SQL à jouer
	$pQuery;			// PDOStatement	:: Requête SQL Préparée
	$type;			// STRING			:: Type de donnée voulu pour la valeur


/** > Initialisation des variables **/
	$table = $_POST['table'];
	$id = $_POST['ID'];
	$property = $_POST['property'];
	$value = $_POST['value'];
	$type = $_POST['type'];


/** > Déclaration et Intialisation des variables pour le moteur (référence) **/


/** -------------------------------------------------------------------------------------------------------------------- **
/** -------------------------------------------------------------------------------------------------------------------- **
/** ---																																					--- **
/** ---									PHASE 4 - EXECUTION DU SCRIPT DE TRAITEMENT DE DONNEES										--- **
/** ---																																					--- **
/** -------------------------------------------------------------------------------------------------------------------- **
/** -------------------------------------------------------------------------------------------------------------------- **/
/** > Elaboration de la requête SQL **/
$query = "
	UPDATE `$table`
	
	SET `$property` = :value
	
	WHERE ID = :id
";

/** > Execution de la requête SQL **/
try {
	switch($type){
		case "BOOL":
			$value = ($value == '0') ? false : true;
		break;
		case "INT":
			$value = intval($value);
		break;
	}
	
	$pQuery = $PDO->prepare($query);
	$pQuery->bindValue(":id", $id);
	$pQuery->bindValue(":value", $value, constant("PDO::PARAM_$type"));
	$pQuery->execute();
} catch (Exception $e){
	echo $e->getMessage();
}



/** -------------------------------------------------------------------------------------------------------------------- **
/** -------------------------------------------------------------------------------------------------------------------- **
/** ---																																					--- **
/** ---											PHASE 5 - GENERATION DES DONNEES DE SORTIE												--- **
/** ---																																					--- **
/** -------------------------------------------------------------------------------------------------------------------- **
/** -------------------------------------------------------------------------------------------------------------------- **/
/** -------------------------------------------------------------------------------------------------------------------- **
/** -------------------------------------------------------------------------------------------------------------------- **
/** ---																																					--- **
/** ---												PHASE 6 - AFFICHER LES SORTIES GENEREE													--- **
/** ---																																					--- **
/** -------------------------------------------------------------------------------------------------------------------- **
/** -------------------------------------------------------------------------------------------------------------------- **/
/** > Création du moteur **/
/** > Configuration du moteur **/
/** > Envoie des données **/
/** > Execution du moteur **/
?>